<!-- 评论资源 -->
<link rel="stylesheet" href="<?php $this->options->themeUrl('assets/css/comment.css'); ?>" id="ajax-comment-css" type="text/css" media="all">

<?php function threadedComments($comments, $options) { ?>
  <li id="<?php $comments->theId(); ?>" class="comment even thread-even depth-<?php echo ($comments->levels) + 1; ?>">
    <article id="div-<?php $comments->theId(); ?>" class="comment-body">
      <footer class="comment-meta">
        <div class="comment-author vcard">
          <img alt="<?php $comments->author(false); ?>" src="<?php echo getavatar($comments->mail); ?>" class="avatar avatar-40 photo" height="40" width="40" loading="lazy" decoding="async">
          <b class="fn">
            <a target="_blank" href="<?php $comments->url(); ?>" rel="external nofollow" class="url"><?php $comments->author(false); ?></a>
            <?php if ($comments->authorId) {if ($comments->authorId == $comments->ownerId) { ?>
              <i class="bi bi-patch-check me-1 ownerId"></i>
            <?php }} ?>
          </b>
        </div>
        <div class="comment-metadata">
          <a href="<?php $comments->permalink(); ?>"><time datetime="<?php $comments->date('Y-m-d\TH:iP'); ?>"><?php $comments->date("Y年m月d日 H:i"); ?></time></a>
        </div>
        <?php if ($comments->status == 'waiting') : ?>
          <em class="comment-awaiting-moderation">您的评论正在审核！</em>
        <?php endif; ?>
      </footer>
      <div class="comment-content">
        <p><?php echo contentFilter($comments->content);?></p>
      </div>
      <div class="reply">
        <a rel="nofollow" class="comment-reply-link" href="<?php echo substr($comments->permalink, 0, - strlen($comments->theId) - 1) . '?replyTo=' . $comments->coid .'#'. $comments->parameter->respondId; ?>" onclick="return TypechoComment.reply('<?php $comments->theId(); ?>', <?php $comments->coid();?>, this);"  aria-label="回复给 <?php $comments->author(false); ?>">回复</a>
      </div>
    </article>
    <?php if ($comments->children) { ?>
      <!-- 子评论 -->
      <ol class="children">
        <?php $comments->threadedComments($options); ?>
      </ol>
    <?php } ?>
  </li>
<?php } ?>

<div class="post_comment" id="post_comment_anchor">
  <div id="comments" class="comments-area">
    <div class="layoutSingleColumn">
      <h3 class="comments-title"><i class="bi bi-filter me-2"></i>评论<small>(<?php $this->commentsNum(); ?>)</small></h3>
      <!-- 评论列表 -->
      <?php $this->comments()->to($comments); ?>
      <?php if ($comments->have()) : ?>
        <ol class="comment-list">
          <?php $comments->listComments(array('before'=>'','after'=>'')); ?>
        </ol>
        <?php 
          $comments->pageNav('上页', '下页', 1, '...', 
            array(
            'wrapTag' => 'div', 
            'wrapClass' => 'comments-nav', 
            'itemTag' => '', 
            'textTag' => 'span', 
            'currentClass' => 'page-numbers current', 
            'prevClass' => 'prev page-numbers', 
            'nextClass' => 'next page-numbers',
          ));
        ?>
      <?php else: ?>
        <div class="commentsTip">
          <svg t="1736836036210" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4011"><path d="M222.00898 788.854394h580.638871c2.627325 0 5.25465-1.970494 5.254651-5.254651s-1.970494-5.25465-5.254651-5.25465H222.00898c-2.627325 0-5.25465 1.970494-5.25465 5.25465s2.627325 5.25465 5.25465 5.254651zM995.756254 825.636947h-289.005773c-2.627325 0-5.25465 1.970494-5.25465 5.25465s1.970494 5.25465 5.25465 5.254651h289.005773c2.627325 0 5.25465-1.970494 5.25465-5.254651s-2.627325-5.25465-5.25465-5.25465zM679.163566 825.636947h-40.72354c-2.627325 0-5.25465 1.970494-5.254651 5.25465s1.970494 5.25465 5.254651 5.254651h40.72354c2.627325 0 5.25465-1.970494 5.254651-5.254651s-1.970494-5.25465-5.254651-5.25465zM611.509942 825.636947H21.018602c-2.627325 0-5.25465 1.970494-5.254651 5.25465s1.970494 5.25465 5.254651 5.254651h590.49134c2.627325 0 5.25465-1.970494 5.254651-5.254651s-2.627325-5.25465-5.254651-5.25465zM144.502886 436.135985c15.10712 0 27.586915-12.479795 27.586915-27.586915 0-15.10712-12.479795-27.586915-27.586915-27.586915-15.10712 0-27.586915 12.479795-27.586914 27.586915-0.656831 15.10712 11.822963 27.586915 27.586914 27.586915z m0-45.978192c9.85247 0 17.734445 7.881976 17.734446 17.734446 0 9.85247-7.881976 17.734445-17.734446 17.734445-9.85247 0-17.734445-7.881976-17.734445-17.734445-0.656831-9.195638 7.881976-17.734445 17.734445-17.734446zM857.821681 697.554843c17.077614 0 30.871071-13.793457 30.871071-30.871071s-13.793457-30.871071-30.871071-30.871072-30.871071 13.793457-30.871072 30.871072c0.656831 17.077614 14.450289 30.871071 30.871072 30.871071z m0-51.889673c11.822963 0 21.018602 9.195638 21.018601 21.018602 0 11.822963-9.195638 21.018602-21.018601 21.018601-11.822963 0-21.018602-9.195638-21.018602-21.018601 0.656831-11.822963 9.85247-21.018602 21.018602-21.018602zM871.615138 488.682489c1.313663 0 2.627325-0.656831 3.284156-1.313663l21.675433-19.704939 20.361771 17.077614c1.970494 1.313663 4.597819 1.313663 6.568313 0l21.675433-17.077614 19.704939 19.048108c1.970494 1.970494 5.25465 1.970494 7.225144 0 1.970494-1.970494 1.970494-5.25465 0-7.225144l-22.989095-22.332265c-1.970494-1.970494-4.597819-1.970494-6.568313 0l-21.675433 17.077614-21.018602-17.077614c-1.970494-1.313663-4.597819-1.313663-6.568313 0l-24.95959 22.332265c-1.970494 1.970494-1.970494 5.25465-0.656831 7.225144 1.313663 1.313663 2.627325 1.970494 3.940988 1.970494zM47.948685 622.676074c1.313663 0 2.627325-0.656831 3.284157-1.313662l21.675433-19.704939 20.36177 17.077614c1.970494 1.313663 4.597819 1.313663 5.911482 0l21.675433-17.077614 19.704939 19.048108c1.970494 1.970494 5.25465 1.970494 7.225144 0 1.970494-1.970494 1.970494-5.25465 0-7.225145L124.797947 592.461835c-1.970494-1.970494-4.597819-1.970494-6.568313 0l-21.675433 17.077613-21.018601-17.077613c-1.970494-1.313663-4.597819-1.313663-6.568313 0l-24.95959 22.332264c-1.970494 1.970494-1.970494 5.25465-0.656831 7.225144 1.970494 0.656831 3.284157 0.656831 4.597819 0.656831zM302.79923 532.033355c7.881976 25.616421-13.136626 55.173829-13.136626 55.83066-1.313663 1.313663-1.313663 3.940988 0 5.254651 0.656831 1.313663 2.627325 2.627325 3.940988 2.627325h0.656831c25.616421-1.970494 49.919179-14.450289 66.339962-34.155228 11.166132 3.940988 22.332264 6.568313 34.155228 8.538807 40.723541 57.144323 116.25914 95.89737 201.647209 95.89737h0.656832c29.557409 0 59.114817-4.597819 87.358563-14.450288 19.048108 22.989096 46.635022 37.439384 76.192431 39.409878h0.656831c1.970494 0 3.284157-0.656831 4.597819-2.627325 0.656831-1.970494 0.656831-3.940988 0-5.254651 0-0.656831-24.302758-35.46889-15.10712-65.68313 51.232842-37.439384 80.79025-90.64272 80.79025-147.130212 0-107.720334-105.093008-195.078897-235.145606-195.078896-9.195638 0-17.734445 0.656831-26.273252 1.313662-36.782553-27.586915-81.447081-41.380372-133.336754-41.380372-112.318153 0-203.617704 76.192431-203.617704 169.462476C232.518281 453.213598 258.134702 499.19179 302.79923 532.033355z m292.946761-247.625401c124.141116 0 225.293137 83.417575 225.293137 185.226427 0 53.860167-28.900577 105.093008-78.162925 140.561899-1.313663 0.656831-1.970494 1.970494-1.970494 3.940987-7.881976 24.959589 3.940988 51.232842 11.166132 65.026299-24.302758-4.597819-45.978191-17.734445-61.742142-36.782553-1.313663-1.970494-3.940988-2.627325-5.911482-1.970493-28.243746 9.85247-57.801155 14.450289-88.015395 14.450288-124.141116 0-225.293137-83.417575-225.293136-185.226427s100.495189-185.226427 224.636305-185.226427z m-159.610006-40.06671c45.32136 0 85.388069 11.166132 118.229634 33.498397C444.674792 293.603592 361.257216 373.737011 361.257216 469.634381c0 31.527903 9.195638 61.742142 25.616421 88.015394-9.195638-1.970494-17.734445-3.940988-26.273252-7.225144-1.970494-0.656831-4.597819 0-5.911482 1.970494-13.136626 16.420783-30.871071 27.586915-51.232841 31.527903 6.568313-11.822963 15.10712-34.155228 9.195638-55.17383 0-1.313663-0.656831-3.284157-1.970494-3.940988C267.987171 494.59397 243.027582 450.586273 243.027582 403.951251c-0.656831-88.015394 86.044901-159.610006 193.108403-159.610007z" fill="#dbdbdb" p-id="4012"></path><path d="M471.604875 444.01796h254.193714c2.627325 0 5.25465-1.970494 5.25465-5.25465s-1.970494-5.25465-5.25465-5.254651H471.604875c-2.627325 0-5.25465 1.970494-5.25465 5.254651s2.627325 5.25465 5.25465 5.25465zM725.141758 507.073765h-33.498397c-2.627325 0-5.25465 1.970494-5.25465 5.254651s1.970494 5.25465 5.25465 5.25465h33.498397c2.627325 0 5.25465-1.970494 5.25465-5.25465s-2.627325-5.25465-5.25465-5.254651zM471.604875 516.926235h181.285439c2.627325 0 5.25465-1.970494 5.254651-5.254651s-1.970494-5.25465-5.254651-5.25465H471.604875c-2.627325 0-5.25465 1.970494-5.25465 5.25465s2.627325 5.25465 5.25465 5.254651z" fill="#dbdbdb" p-id="4013"></path></svg>
          <p>暂无</p>
        </div>
      <?php endif; ?>
      <!-- 评论表单 -->
      <?php if ($this->allow('comment')) : ?>
      <div id="<?php $this->respondId(); ?>" class="comment-respond">
        <h3 id="reply-title" class="comment-reply-title">
          <i class="bi bi-keyboard me-1"></i>发布评论 
          <small>
            <?php $comments->cancelReply(); ?>
          </small>
        </h3>
        <form action="<?php $this->commentUrl() ?>" method="post" id="commentform" class="comment-form">
          <p class="comment-form-comment">
            <textarea id="comment" name="text" aria-required="true"></textarea>
          </p>
          <?php if($this->user->hasLogin()): ?>
            <div class="hasLogin">
              <span><?php $this->author->screenName(); ?> - 已登陆</span>
              <a href="<?php $this->options->logoutUrl(); ?>">
                <svg t="1737103824833" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5927" width="100" height="100"><path d="M0 192v640c0 70.7 57.3 128 128 128h352c17.7 0 32-14.3 32-32s-14.3-32-32-32H128c-35.3 0-64-28.7-64-64V192c0-35.3 28.7-64 64-64h352c17.7 0 32-14.3 32-32s-14.3-32-32-32H128C57.3 64 0 121.3 0 192z" p-id="5928"></path><path d="M1013.3 488.3L650.9 160.7c-41.2-37.2-106.9-8-106.9 47.5V339c0 4.4-3.6 8-8 8H224c-17.7 0-32 14.3-32 32v266c0 17.7 14.3 32 32 32h312c4.4 0 8 3.6 8 8v130.9c0 55.5 65.8 84.7 106.9 47.5l362.4-327.6c14.1-12.8 14.1-34.8 0-47.5zM256 597V427c0-8.8 7.2-16 16-16h304c17.7 0 32-14.3 32-32V244.9c0-13.9 16.4-21.2 26.7-11.9L938 506.1c3.5 3.2 3.5 8.7 0 11.9L634.7 791c-10.3 9.3-26.7 2-26.7-11.9V645c0-17.7-14.3-32-32-32H272c-8.8 0-16-7.2-16-16z" p-id="5929"></path></svg>
              </a>
            </div>
          <?php else: ?>
            <p class="comment-form-author">
              <input id="author" class="blog-form-input" placeholder="昵称" name="author" type="text" value="<?php $this->remember('author'); ?>" size="30">
            </p>
            <p class="comment-form-email">
              <input id="email" class="blog-form-input" placeholder="Email " name="mail" type="text" value="<?php $this->remember('mail'); ?>" size="30">
            </p>
            <p class="comment-form-url">
              <input id="url" class="blog-form-input" placeholder="网站地址" name="url" type="text" value="<?php $this->remember('url'); ?>" size="30">
            </p>
          <?php endif; ?>
            <p class="form-submit">
              <input name="submit" type="submit" id="submit" class="submit" value="发布评论">
            </p>
        </form>
      </div>
      <?php endif; ?>
    </div>
  </div>
</div>

<!-- 评论资源 -->
<script type="text/javascript" src="<?php $this->options->themeUrl('assets/js/comment.js'); ?>" id="ajax-comment-js"></script>
